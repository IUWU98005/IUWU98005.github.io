<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | My Blog</title><meta name=keywords content><meta name=description content="Posts - My Blog"><meta name=author content><link rel=canonical href=https://iuwu98005.github.io/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://iuwu98005.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://iuwu98005.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://iuwu98005.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://iuwu98005.github.io/apple-touch-icon.png><link rel=mask-icon href=https://iuwu98005.github.io/safari-pinned-tab.svg><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#ffffff"><link rel=alternate type=application/rss+xml href=https://iuwu98005.github.io/posts/index.xml><link rel=alternate hreflang=en href=https://iuwu98005.github.io/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://iuwu98005.github.io/posts/"><meta property="og:site_name" content="My Blog"><meta property="og:title" content="Posts"><meta property="og:description" content="A modern tech blog"><meta property="og:locale" content="en-us"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="A modern tech blog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://iuwu98005.github.io/posts/"}]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://iuwu98005.github.io/ accesskey=h title="My Blog (Alt + H)">My Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://iuwu98005.github.io/posts/ title=Posts><span class=active>Posts</span></a></li><li><a href=https://iuwu98005.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://iuwu98005.github.io/about/ title=About><span>About</span></a></li><li><a href=https://iuwu98005.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://iuwu98005.github.io/>Home</a></div><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>ä½¿ç”¨ ThreadPoolExecutor å’Œ Barrier è¿›è¡Œæ¥å£å¹¶å‘æµ‹è¯•</h2></header><div class=entry-content><p>ä¸‹é¢ä»¥æ¥å£æ”¯ä»˜å¹¶å‘ä¸ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡ ThreadPoolExecutor + Barrier åŒæ­¥è§¦å‘è¯·æ±‚ï¼Œå¹¶æ”¶é›†ç»“æœä¸é”™è¯¯ä¿¡æ¯ã€‚
ç¤ºä¾‹ä»£ç  import threading from concurrent.futures import FIRST_EXCEPTION, ThreadPoolExecutor, wait from typing import Any, Optional import pytest from api import OrderAPI from factory import order_pay_payload class TestOrderPay: @pytest.mark.concurrent @pytest.mark.parametrize( "generator", [{"pay_need": 5, "user_id": 10005, "org_id": 1}], indirect=True ) def test_concurrent_req(self, order_api: OrderAPI, generator: dict): """å¹¶å‘æ”¯ä»˜ï¼Œç¡®ä¿åªæœ‰ä¸€ä¸ªè¯·æ±‚æˆåŠŸï¼Œå…¶ä½™è¯·æ±‚å¤±è´¥""" order_nos: list = [order["orderNo"] for order in generator["pay_need_orders"]] n: int = len(order_nos) barrier: threading.Barrier = threading.Barrier(n) results: list[dict[str, Any]] = [] errors: dict[str, str] = {} def worker(order_no: str) -> Optional[dict[str, Any]]: try: barrier.wait(timeout=5) data = order_api.pay_order(payload=order_pay_payload(order_no=order_no)) return { "order_no": order_no, "success": data["success"], "code": data["code"], "message": data["message"], } except threading.BrokenBarrierError as e: errors[order_no] = str(e) return None except Exception as e: errors[order_no] = str(e) return None with ThreadPoolExecutor(max_workers=n) as executor: # è®°å½•æ‰€æœ‰ future å¯¹è±¡ä»¥åŠå…¶å¯¹åº”çš„ order_no future_map = {executor.submit(worker, order_no): order_no for order_no in order_nos} done, not_done = wait( future_map, return_when=FIRST_EXCEPTION, timeout=10 ) for future in done: result = future.result() if result: results.append(result) for future in not_done: order_no = future_map[future] future.cancel() errors[order_no] = "Request timed out or was cancelled." assert len(errors) == 0, f"Errors occurred during requests: {errors}" assert len([r for r in results if r.get("success") is True]) == 1 è¯´æ˜ Barrier ç”¨äºå¯¹é½æ‰€æœ‰çº¿ç¨‹çš„èµ·è·‘çº¿ï¼Œç¡®ä¿åœ¨åŒä¸€æ—¶é—´ç‚¹å‘èµ·è¯·æ±‚ï¼Œæ¨¡æ‹Ÿé«˜å¹¶å‘åœºæ™¯ã€‚ barrier.wait(timeout=5) ä¼šé˜»å¡çº¿ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æˆ–è¶…æ—¶ã€‚ é€šè¿‡ wait(..., return_when=FIRST_EXCEPTION) å¯ä»¥åœ¨å‘ç”Ÿé¦–ä¸ªå¼‚å¸¸åæå‰ç»“æŸç­‰å¾…ï¼Œé¿å…æ— æ„ä¹‰çš„é•¿æ—¶é—´é˜»å¡ã€‚ future_map ç”¨äºå°† Future ä¸ order_no å…³è”ï¼Œä¾¿äºå®šä½è¶…æ—¶æˆ–å¼‚å¸¸è¯·æ±‚ã€‚ é¢å¤–æ³¨æ„ requests é»˜è®¤çš„è¿æ¥æ± å¤§å°ä¸º 10ã€‚å¦‚æœå¹¶å‘æµ‹è¯•éœ€è¦æ›´é«˜çš„è¿æ¥æ•°ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®è¿æ¥æ± ï¼ˆä¾‹å¦‚é€šè¿‡ HTTPAdapter(pool_maxsize=...)ï¼‰ä»¥é¿å…è¿æ¥æ•°æˆä¸ºç“¶é¢ˆã€‚
...</p></div><footer class=entry-footer><span title='2026-02-02 13:28:05 +0800 +0800'>February 2, 2026</span>&nbsp;Â·&nbsp;2 min</footer><a class=entry-link aria-label="post link to ä½¿ç”¨ ThreadPoolExecutor å’Œ Barrier è¿›è¡Œæ¥å£å¹¶å‘æµ‹è¯•" href=https://iuwu98005.github.io/posts/26012202/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Python `__repr__` å’Œ `__str__`</h2></header><div class=entry-content><p>class Person(Object): def __init__(self, name: str): self.name = name p = Person("Alexander") ä¸Šé¢è¿™æ®µä»£ç ï¼Œåœ¨ç»ˆç«¯æ‰“å°æ—¶ï¼Œæ‰“å°çš„ç»“æœæ˜¯å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œç±»ä¼¼ä»¥ä¸‹è¾“å‡ºï¼š
>>> print(p) &lt;__main__.Person object at 0x10f29b940> >>> p &lt;__main__.Person object at 0x10f29b940> >>> p.__str__() &lt;__main__.Person object at 0x10f29b940> >>> p.__repr__() &lt;__main__.Person object at 0x10f29b940> é‡å†™ __str__ æ–¹æ³• class Person(Object): ... def __str__(self): return f"__str__ æ–¹æ³•, name: {self.name}" p = Person("Alexander") æ­¤æ—¶å†æ¬¡åœ¨ç»ˆç«¯æ‰“å°ï¼Œæ­¤æ—¶çš„è¾“å‡ºç»“æœå˜æˆä»¥ä¸‹æƒ…å†µï¼š
>>> print(p) __str__ æ–¹æ³•, name: Alexander >>> str(p) __str__ æ–¹æ³•, name: Alexander >>> f"{p}" __str__ æ–¹æ³•, name: Alexander >>> p.__str__() __str__ æ–¹æ³•, name: Alexander >>> p &lt;demo.Person object at 0x10e0e3588> é‡å†™ __repr__ æ–¹æ³• class Person(Object): ... def __repr__(self): return f"__repr__ æ–¹æ³•, name: {self.name}" p = Person("Alexander") ç›´æ¥è¾“å‡ºå¯¹è±¡ï¼š
...</p></div><footer class=entry-footer><span title='2026-02-02 13:25:55 +0800 +0800'>February 2, 2026</span>&nbsp;Â·&nbsp;1 min</footer><a class=entry-link aria-label="post link to Python  `__repr__` å’Œ `__str__` " href=https://iuwu98005.github.io/posts/26012201/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>é…ç½® Clash åˆ†æµè§„åˆ™ä»¥ä½¿ç”¨ Gemini</h2></header><div class=entry-content><p>Gemini æœåŠ¡å¯¹åœ°åŸŸä¸€è‡´æ€§æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œéœ€è¦æ‰€æœ‰è°·æ­Œç›¸å…³åŸŸåçš„ IP åœ°å€æ¥è‡ªåŒä¸€åœ°åŒºã€‚å› æ­¤åœ¨ Clash åˆ†æµè§„åˆ™ä¸­ï¼Œå¿…é¡»å°†æ‰€æœ‰è°·æ­Œç›¸å…³åŸŸåè·¯ç”±åˆ°åŒä¸€ä¸ªä»£ç†èŠ‚ç‚¹ã€‚
é…ç½®åˆ†æµè§„åˆ™ // ğŸ“¢ è°·æ­ŒæœåŠ¡ - è¯·æ›¿æ¢ä¸ºä½ çš„ä»£ç†ç»„åç§°ï¼Œå»ºè®®ä½¿ç”¨ç¾å›½èŠ‚ç‚¹ "DOMAIN-SUFFIX,google.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google ä¸»åŸŸå "DOMAIN-SUFFIX,google.com.hk,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google é¦™æ¸¯ "DOMAIN-SUFFIX,googleapis.cn,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google ä¸­å›½API "DOMAIN-SUFFIX,googleapis.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google API "DOMAIN-SUFFIX,googleusercontent.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google ç”¨æˆ·å†…å®¹ "DOMAIN-SUFFIX,gstatic.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google é™æ€èµ„æº "DOMAIN-SUFFIX,ggpht.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google Photos/YouTubeç¼©ç•¥å›¾ "DOMAIN-SUFFIX,googleadservices.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google å¹¿å‘ŠæœåŠ¡ "DOMAIN-SUFFIX,googlevideo.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google è§†é¢‘ "DOMAIN-SUFFIX,gvt1.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google è§†é¢‘ç¼©ç•¥å›¾ "DOMAIN-SUFFIX,xn--ngstr-lra8j.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google Playä¸‹è½½æœåŠ¡ "DOMAIN-SUFFIX,googleplay.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google PlayåŸŸå "DOMAIN-SUFFIX,googlesource.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google æºä»£ç  "DOMAIN-SUFFIX,googletagmanager.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google æ ‡ç­¾ç®¡ç†å™¨ "DOMAIN-SUFFIX,googletagservices.com,ğŸ“¢ è°·æ­ŒæœåŠ¡", // Google æ ‡ç­¾æœåŠ¡ æ•…éšœæ’æŸ¥ å¦‚æœé…ç½®åè®¿é—® Gemini ä»æŠ¥é”™ IP åœ°å€ä¸åŒ¹é…ï¼Œè¯·åœ¨ Clash çš„è¿æ¥æ—¥å¿—ä¸­æ£€æŸ¥æ˜¯å¦æœ‰è°·æ­Œç›¸å…³åŸŸåæœªæŒ‰è§„åˆ™è·¯ç”±ã€‚ç¡®ä¿æ‰€æœ‰æ¶‰åŠçš„åŸŸåéƒ½å·²æ­£ç¡®é…ç½®åˆ° ğŸ“¢ è°·æ­ŒæœåŠ¡ åˆ†ç»„ä¸­ã€‚
...</p></div><footer class=entry-footer><span title='2026-02-02 13:15:57 +0800 +0800'>February 2, 2026</span>&nbsp;Â·&nbsp;1 min</footer><a class=entry-link aria-label="post link to é…ç½® Clash åˆ†æµè§„åˆ™ä»¥ä½¿ç”¨ Gemini" href=https://iuwu98005.github.io/posts/260122-gemini/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>è§£å†³ä¸­åŒº Apple Music æ›²åº“è¾ƒå°‘çš„é—®é¢˜</h2></header><div class=entry-content><p>yt-dlp -x --audio-format m4a --audio-quality 0 --embed-thumbnail --add-metadata "è§†é¢‘URL" é‡åˆ°å–œæ¬¢çš„éŸ³ä¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ yt-dlp å·¥å…·ä¸‹è½½è§†é¢‘ URL ä¸­çš„éŸ³ä¹ã€‚ä¸Šè¿°å‘½ä»¤ä¼šæå–éŸ³é¢‘å¹¶ä¿å­˜ä¸ºé«˜è´¨é‡çš„ m4a æ ¼å¼ï¼ŒåŒæ—¶åµŒå…¥å°é¢å’Œå…ƒæ•°æ®ã€‚
åœ¨ Apple Music ä¸­æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œä¸€é”®å¯¼å…¥ä¸ªäººèµ„æ–™åº“å³å¯ã€‚</p></div><footer class=entry-footer><span title='2025-12-31 10:29:14 +0800 +0800'>December 31, 2025</span>&nbsp;Â·&nbsp;1 min</footer><a class=entry-link aria-label="post link to è§£å†³ä¸­åŒº Apple Music æ›²åº“è¾ƒå°‘çš„é—®é¢˜" href=https://iuwu98005.github.io/posts/251231-applemusic/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>@classmethod ç®€ä»‹ä¸å®è·µåº”ç”¨ï¼ˆ251104æ›´æ–°ï¼‰</h2></header><div class=entry-content><p>ç®€å•ä»‹ç» @classmethod æ˜¯ä¸ç±»ç»‘å®š, è€Œä¸æ˜¯å®ä¾‹çš„æ–¹æ³•. å®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ cls â€“ ä»£è¡¨å½“å‰ç±»å¯¹è±¡.
å®ä¾‹æ–¹æ³•: éœ€è¦åˆ›å»ºå¯¹è±¡æ‰èƒ½ä½¿ç”¨ ç±»æ–¹æ³•: å¯ä»¥ç›´æ¥é€šè¿‡ç±»è°ƒç”¨ class Example: @classmethod def print_class(cls): print(f"this method belongs to class {cls.__name__}") Example.print_class() # è¾“å‡º: this method belongs to class Example cls ä¸ºç±»æ–¹æ³•ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°, æ„å‘³ç€ç±»æ–¹æ³•å¯ä»¥è®¿é—®å’Œä¿®æ”¹ç±»çº§åˆ«çš„æ•°æ®, è€Œä¸æ˜¯å®ä¾‹çº§åˆ«çš„æ•°æ®.
class Counter: count = 1 def __init__(self): Counter.count += 1 @classmethod def print_count(cls): print(cls.count) a = Counter() b = Counter() Counter.print_count() # è¾“å‡º: 2 å®ä¾‹æ–¹æ³•å¯ä»¥é€šè¿‡ self.&lt;attr> æ¥è®¿é—®ç±»å±æ€§, ç±»æ–¹æ³•å¯ä»¥é€šè¿‡ cls.&lt;attr> æ¥è®¿é—®. åœ¨å¤–éƒ¨å¯ä»¥é€šè¿‡ &lt;Class>.&lt;attr> æ¥è®¿é—®ç±»å±æ€§. ç±»æ–¹æ³•å¯ä»¥ç›´æ¥è°ƒç”¨ cls.&lt;attr> æ¥å¯¹ç±»å±æ€§è¿›è¡Œä¿®æ”¹, å®ä¾‹æ–¹æ³•åˆ™éœ€è¦é€šè¿‡ self.__class__.&lt;attr> æ¥è¿›è¡Œä¿®æ”¹. classmethod å­˜åœ¨çš„æ„ä¹‰ æ—¢ç„¶å®ä¾‹æ–¹æ³•å·²ç»å¯ä»¥è®¿é—®å’Œä¿®æ”¹ç±»å±æ€§, ä¸ºä»€ä¹ˆè¿˜éœ€è¦å®ä¾‹æ–¹æ³• @classmethod
...</p></div><footer class=entry-footer><span title='2025-10-28 14:34:35 +0800 +0800'>October 28, 2025</span>&nbsp;Â·&nbsp;2 min</footer><a class=entry-link aria-label="post link to @classmethod ç®€ä»‹ä¸å®è·µåº”ç”¨ï¼ˆ251104æ›´æ–°ï¼‰" href=https://iuwu98005.github.io/posts/251028-classmethod/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://iuwu98005.github.io/posts/page/2/>Next&nbsp;&nbsp;Â»</a></nav></footer></main><footer class=footer><span>Â© 2025 IUWU98005</span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>